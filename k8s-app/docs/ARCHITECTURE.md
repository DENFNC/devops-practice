# Слоистая архитектура Go приложения

## Структура проекта

```
app/
├── main.go              # Точка входа приложения
├── config/              # Конфигурационный слой
│   └── config.go        # Загрузка конфигурации из переменных окружения
├── models/              # Слой моделей данных
│   └── response.go      # Структуры для API ответов
├── services/            # Слой бизнес-логики
│   ├── app_service.go   # Основной сервис приложения
│   └── errors.go        # Определение ошибок сервиса
├── handlers/            # Слой HTTP обработчиков
│   └── handlers.go      # HTTP handlers для всех endpoints
└── middleware/          # Слой middleware
    └── logging.go       # Middleware для логирования запросов
```

## Архитектурные принципы

### 1. Разделение ответственности
- **Models**: Структуры данных и типы
- **Services**: Бизнес-логика и состояние приложения
- **Handlers**: HTTP обработка запросов
- **Middleware**: Перекрестные функции (логирование, метрики)
- **Config**: Конфигурация приложения

### 2. Dependency Injection
- Handlers получают зависимости через конструктор
- Services инкапсулируют бизнес-логику
- Четкое разделение между слоями

### 3. Тестируемость
- Каждый слой можно тестировать независимо
- Легко создавать моки для зависимостей
- Изолированная бизнес-логика

## Преимущества новой архитектуры

### ✅ Читаемость
- Код структурирован по функциональности
- Легко найти нужную логику
- Понятные названия пакетов

### ✅ Поддерживаемость
- Изменения в одном слое не влияют на другие
- Легко добавлять новую функциональность
- Четкие границы ответственности

### ✅ Тестируемость
- Каждый слой тестируется отдельно
- Легко создавать unit тесты
- Моки для внешних зависимостей

### ✅ Масштабируемость
- Легко добавлять новые endpoints
- Простое расширение middleware
- Гибкая конфигурация

## Использование

### Запуск приложения
```bash
go run app/main.go
```

### Сборка
```bash
go build ./app
```

### Тестирование
```bash
go test ./app/...
```

## Endpoints

- `GET /` - Главная страница с статусом
- `GET /health` - Health check для Kubernetes
- `GET /ready` - Readiness probe
- `GET /metrics` - Метрики приложения
- `GET /load` - Имитация обработки нагрузки

## Конфигурация

Приложение поддерживает следующие переменные окружения:

- `PORT` - Порт для HTTP сервера (по умолчанию: 8080)
- `LOG_LEVEL` - Уровень логирования (по умолчанию: info)
- `METRICS_ENABLED` - Включить метрики (по умолчанию: true)
- `INIT_DELAY` - Задержка инициализации (по умолчанию: 5s)
- `HEALTH_INTERVAL` - Интервал health check (по умолчанию: 10s)
- `READINESS_TIMEOUT` - Таймаут readiness probe (по умолчанию: 3s)
- `LIVENESS_TIMEOUT` - Таймаут liveness probe (по умолчанию: 5s)

